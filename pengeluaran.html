<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Input Pengeluaran</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>

    <script>
        document.addEventListener("contextmenu", e => e.preventDefault());
        document.addEventListener("selectstart", e => e.preventDefault());
        document.addEventListener("keydown", e => {
          if (
            e.key === "F12" ||
            (e.ctrlKey && ["u","U","c","C","x","X","s","S","a","A"].includes(e.key)) ||
            (e.ctrlKey && e.shiftKey && ["I","i","J","j"].includes(e.key))
          ) e.preventDefault();
        });
    </script>

    <style>
        :root {
            --primary-color: #007BFF; 
            --secondary-color: #28a745; 
            --danger-color: #dc3545; 
            --warning-color: #ffc107;
            --background-light: #f4f7f6;
            --text-dark: #343a40;
            --border-radius: 8px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-light);
            color: var(--text-dark);
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 50px auto;
        }

        .panel {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
        }

        h2 {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--danger-color);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            text-align: left; /* <-- Angka input rata kiri */
        }

        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            margin-top: 20px;
            font-size: 1em;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #bd2130;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            text-decoration: none; /* hilangkan garis bawah */
        }

        .btn-primary:hover {
            background-color: #0056b3;
        }
        /* 1. Input angka dari kiri */
input[type="number"] {
    text-align: left; /* sebelumnya: right */
}

/* 2. Tombol lihat & ekspor sama dengan tombol simpan */
.btn-export {
    display: block;
    width: 100%;
    padding: 15px;
    text-decoration: none;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    text-align: center; /* tulisan di tengah */
    background-color: var(--primary-color);
    color: white;
    border: none;
    margin-top: 20px;
    box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
    transition: background-color 0.2s;
}
.btn-export:hover {
    background-color: #0056b3;
    text-decoration: none; /* hilangkan garis bawah saat hover */
}


        .btn-back {
            display: inline-block;
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            transition: background-color 0.2s;
            margin-bottom: 20px;
        }

        .btn-back:hover {
            background-color: #5a6268;
        }

        #status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: var(--border-radius);
            text-align: center;
            display: none;
        }

        .success { background-color: #d4edda; color: var(--secondary-color); border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: var(--danger-color); border: 1px solid #f5c6cb; }

        @media (max-width: 480px) {
            .panel { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <a href="history.html" class="btn-back">‚¨ÖÔ∏è Kembali ke Riwayat</a>
        
        <div class="panel">
            <h2>üí∞ Catat Pengeluaran</h2>
            
            <form id="expense-form">
                <div class="form-group">
                    <label for="deskripsi">Deskripsi Pengeluaran (Beli Apa?)</label>
                    <input type="text" id="deskripsi" required placeholder="Contoh: Beli Bahan Baku, Bayar Listrik...">
                </div>
                
                <div class="form-group">
                    <label for="jumlah">Jumlah Pengeluaran (Rupiah)</label>
                    <input type="number" id="jumlah" required min="1" placeholder="Masukkan angka tanpa titik/koma">
                </div>
                
                <button type="submit" class="btn btn-danger">Simpan Pengeluaran</button>
                <a href="ekspor.html" class="btn-export">Lihat & Ekspor Data Pengeluaran</a>
            </form>
            
            <div id="status-message"></div>
        </div>
    </div>

    <script>
        function getOrCreateCashierId() {
            let idKasir = localStorage.getItem("cashier_id");
            if (!idKasir) {
                idKasir = "KSR-" + Math.random().toString(36).substring(2, 10).toUpperCase();
                localStorage.setItem("cashier_id", idKasir);
            }
            return idKasir;
        }

        const deviceCashierId = getOrCreateCashierId();

        const firebaseConfig = {
            apiKey: "AIzaSyBN7iZX6CNHMEENgsFoS8VHhguRreE-xRs",
            authDomain: "kasirku-1d33c.firebaseapp.com",
            databaseURL: "https://kasirku-1d33c-default-rtdb.firebaseio.com/",
            projectId: "kasirku-1d33c",
            storageBucket: "kasirku-1d33c.appspot.com",
            messagingSenderId: "440756410882",
            appId: "1:440756410882:web:674a56658a0f5241d0651b",
            measurementId: "G-D7C4321WB4"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const pengeluaranRef = database.ref('Pengeluaran');

        const expenseForm = document.getElementById('expense-form');
        const statusMessage = document.getElementById('status-message');

        expenseForm.addEventListener('submit', function(e) {
            e.preventDefault();

            const deskripsi = document.getElementById('deskripsi').value.trim();
            const jumlah = parseFloat(document.getElementById('jumlah').value);

            if (deskripsi === "" || isNaN(jumlah) || jumlah <= 0) {
                showMessage("Harap isi deskripsi dan jumlah pengeluaran dengan benar.", "error");
                return;
            }

            const newExpense = {
                id_kasir: deviceCashierId,
                deskripsi: deskripsi,
                jumlah: jumlah,
                timestamp: new Date().toISOString()
            };

            pengeluaranRef.push(newExpense)
                .then(() => {
                    showMessage("‚úÖ Pengeluaran berhasil dicatat!", "success");
                    expenseForm.reset();
                })
                .catch((error) => {
                    console.error("Gagal mencatat pengeluaran:", error);
                    showMessage(`‚ùå Gagal menyimpan data: ${error.message}`, "error");
                });
        });

        function showMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = '';
            statusMessage.classList.add(type);
            statusMessage.style.display = 'block';

            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }
    </script>

</body>
</html>
